<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintForge Pricing Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.1/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle navigation">
                    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1>
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="PrintForge Logo" class="logo-icon">
                    <span class="brand">PrintForge</span> Pricing Calculator
                </h1>
            </div>
        </header>

        <!-- Sidebar Navigation -->

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Navigation</h3>
                <button class="sidebar-close" onclick="toggleSidebar()">√ó</button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Calculator</div>
                <button class="tab-button active" data-tab="calculator">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="4" y="2" width="16" height="20" rx="2"/>
                        <line x1="8" y1="6" x2="16" y2="6"/>
                        <line x1="8" y1="10" x2="16" y2="10"/>
                        <line x1="8" y1="14" x2="16" y2="14"/>
                        <line x1="8" y1="18" x2="12" y2="18"/>
                    </svg>
                    <span>Calculator</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Operations</div>
                <button class="tab-button" data-tab="batch">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Batch Quote</span>
                </button>
                <button class="tab-button" data-tab="compare">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"/>
                        <line x1="12" y1="20" x2="12" y2="4"/>
                        <line x1="6" y1="20" x2="6" y2="14"/>
                    </svg>
                    <span>Compare</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Management</div>
                <button class="tab-button" data-tab="clients">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                    <span>Clients</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Data</div>
                <button class="tab-button" data-tab="history">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    <span>History</span>
                </button>
                <button class="sidebar-action-button" onclick="openBackupManager()" title="Manage Backups">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    <span>Backups</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Output</div>
                <button class="tab-button" data-tab="results">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 11 12 14 22 4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    <span>Results</span>
                </button>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-header">Settings</div>
                <button class="sidebar-action-button" id="sidebarThemeToggle" title="Toggle theme">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                    </svg>
                    <span id="sidebarThemeText">Dark Mode</span>
                </button>
                <button class="tab-button" data-tab="settings">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6m6-12l-4 4m-4 4-4 4m16-4h-6m-6 0H1m18-8l-4 4m-4 4-4 4"/>
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
        </div>

        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn btn-secondary" onclick="saveConfig()" title="Save configuration (Ctrl+S)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                Save
            </button>
            <button class="btn btn-secondary" onclick="document.getElementById('load-file').click()" title="Load configuration (Ctrl+L)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                </svg>
                Load
            </button>
            <input type="file" id="load-file" accept=".json" style="display: none;" onchange="loadConfig(event)">
            <div class="export-dropdown">
                <button class="btn btn-secondary" onclick="toggleExportMenu()" title="Export options">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Export
                    <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: 4px;">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>
                <div class="export-menu" id="export-menu" style="display: none;">
                    <button onclick="exportToExcel(); toggleExportMenu();">üìä Export to Excel</button>
                    <button onclick="exportToPDF(); toggleExportMenu();">üìÑ Export to PDF</button>
                </div>
            </div>
            <div class="template-dropdown">
                <button class="btn btn-secondary" onclick="toggleTemplateMenu()" title="Quote templates">
                    Templates
                    <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: 4px;">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>
                <div class="template-menu" id="template-menu" style="display: none;">
                    <button onclick="openTemplateManager()">Manage Templates</button>
                    <button onclick="openSaveTemplateModal()">Save Current as Template</button>
                    <div class="menu-divider"></div>
                    <div id="quick-template-list">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
            <button class="btn btn-secondary" onclick="createManualBackup()" title="Create backup">Backup</button>
            <div class="spacer"></div>
            <button class="btn btn-primary" onclick="calculateAndShowResults()" title="Calculate pricing (Ctrl+R)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
                Calculate
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            
            <!-- Calculator Tab (Combined: Basic Info + Hardware + Packaging + Advanced) -->
            <div id="calculator-tab" class="tab-pane active">
                <div class="section">
                    <h2>Product Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Client (Optional):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Select a client to track this quote and apply default discount</span>
                                </span>
                            </label>
                            <select id="selected_client" onchange="applyClientDefaults()">
                                <option value="">-- No Client --</option>
                                <!-- Populated by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Part Name:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The name of the part or product being quoted</span>
                                </span>
                            </label>
                            <input type="text" id="part_name" placeholder="New Part">
                        </div>
                        <div class="form-group">
                            <label>Revision:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Version number of this part design (e.g., V1, V2, Rev A)</span>
                                </span>
                            </label>
                            <input type="text" id="revision" placeholder="V1">
                        </div>
                        <div class="form-group">
                            <label>Prepared By:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Name of the person creating this quote</span>
                                </span>
                            </label>
                            <input type="text" id="prepared_by" placeholder="Your Name">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Material & Print Settings</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Material Type & Presets:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Select a material type or apply a saved preset with pre-configured cost</span>
                                </span>
                            </label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                                <select id="material_type" onchange="handleMaterialSelection()" style="flex: 1;">
                                    <option value="_add_preset">‚ûï Add Custom Preset</option>
                                    <optgroup label="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Standard Materials ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ">
                                        <option value="PLA">PLA (Polylactic Acid)</option>
                                        <option value="PLA+">PLA+ (Enhanced PLA)</option>
                                        <option value="ABS">ABS (Acrylonitrile Butadiene Styrene)</option>
                                        <option value="PETG">PETG (Polyethylene Terephthalate Glycol)</option>
                                        <option value="ASA">ASA (Acrylonitrile Styrene Acrylate)</option>
                                        <option value="TPU">TPU (Thermoplastic Polyurethane)</option>
                                        <option value="TPE">TPE (Thermoplastic Elastomer)</option>
                                        <option value="Nylon">Nylon (Polyamide)</option>
                                        <option value="Nylon 6">Nylon 6</option>
                                        <option value="Nylon 12">Nylon 12</option>
                                        <option value="PC">PC (Polycarbonate)</option>
                                        <option value="PC-ABS">PC-ABS Blend</option>
                                        <option value="HIPS">HIPS (High Impact Polystyrene)</option>
                                        <option value="PVA">PVA (Polyvinyl Alcohol - Support)</option>
                                        <option value="BVOH">BVOH (Support Material)</option>
                                        <option value="Carbon Fiber PLA">Carbon Fiber PLA</option>
                                        <option value="Carbon Fiber PETG">Carbon Fiber PETG</option>
                                        <option value="Carbon Fiber Nylon">Carbon Fiber Nylon</option>
                                        <option value="Glass Fiber Nylon">Glass Fiber Nylon</option>
                                        <option value="Wood PLA">Wood PLA</option>
                                        <option value="Metal PLA">Metal PLA</option>
                                        <option value="Marble PLA">Marble PLA</option>
                                        <option value="Silk PLA">Silk PLA</option>
                                        <option value="Glow in the Dark PLA">Glow in the Dark PLA</option>
                                        <option value="PEEK">PEEK (Polyether Ether Ketone)</option>
                                        <option value="PEKK">PEKK (Polyetherketoneketone)</option>
                                        <option value="PEI">PEI (Polyetherimide/ULTEM)</option>
                                        <option value="PPSU">PPSU (Polyphenylsulfone)</option>
                                        <option value="PP">PP (Polypropylene)</option>
                                        <option value="PMMA">PMMA (Acrylic)</option>
                                        <option value="PET">PET (Polyethylene Terephthalate)</option>
                                        <option value="Flexible PLA">Flexible PLA</option>
                                        <option value="TPU 95A">TPU 95A (Shore Hardness)</option>
                                        <option value="TPU 85A">TPU 85A (Shore Hardness)</option>
                                        <option value="PVB">PVB (Polyvinyl Butyral)</option>
                                        <option value="PVDF">PVDF (Polyvinylidene Fluoride)</option>
                                    </optgroup>
                                    <optgroup label="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ System Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ" id="system-presets-group">
                                        <option value="preset-system-pla" data-cost="40.00">PLA Standard - NZD $40.00/kg</option>
                                        <option value="preset-system-petg" data-cost="55.00">PETG Standard - NZD $55.00/kg</option>
                                        <option value="preset-system-abs" data-cost="50.00">ABS Standard - NZD $50.00/kg</option>
                                        <option value="preset-system-tpu" data-cost="75.00">TPU Flexible - NZD $75.00/kg</option>
                                        <option value="preset-system-nylon" data-cost="80.00">Nylon Engineering - NZD $80.00/kg</option>
                                    </optgroup>
                                    <optgroup label="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ User Presets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ" id="user-presets-group">
                                        <!-- User presets populated dynamically -->
                                    </optgroup>
                                </select>
                                <button class="btn btn-sm btn-secondary" onclick="openPresetManager()" title="Manage Custom Presets" style="white-space: nowrap;">
                                    üîß Manage
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Filament Cost (NZD/kg):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Cost per kilogram of filament material (check your supplier pricing)</span>
                                </span>
                            </label>
                            <input type="number" id="filament_cost" placeholder="40.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Filament Required (g):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Total grams of filament needed for this print (from slicer software)</span>
                                </span>
                            </label>
                            <input type="number" id="filament_required" placeholder="34.78" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Total Print Time (hours):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Estimated print duration in hours (from slicer software)</span>
                                </span>
                            </label>
                            <input type="number" id="print_time" placeholder="4.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Labor Required (minutes):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Time needed for setup, removal, cleanup, and post-processing (minutes)</span>
                                </span>
                            </label>
                            <input type="number" id="labor_time" placeholder="30" step="1" min="0">
                        </div>
                    </div>
                </div>

                <!-- Hardware Section -->
                <div class="section">
                    <h2>Hardware Costs</h2>
                    <p class="info-text">Add hardware components like screws, magnets, inserts, etc.</p>
                    
                    <table id="hardware-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Unit Cost ($)</th>
                                <th>Total ($)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Hardware rows will be added here -->
                        </tbody>
                    </table>

                    <button class="btn btn-secondary" onclick="addHardwareRow()">Add Item</button>
                </div>

                <!-- Packaging Section -->
                <div class="section">
                    <h2>Packaging & Shipping</h2>
                    <p class="info-text">Add packaging materials like boxes, bubble wrap, tape, and shipping costs.</p>
                    
                    <table id="packaging-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Unit Cost ($)</th>
                                <th>Total ($)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Packaging rows will be added here -->
                        </tbody>
                    </table>

                    <button class="btn btn-secondary" onclick="addPackagingRow()">Add Item</button>
                </div>

                <div class="section">
                    <h2>Shipping Cost</h2>
                    <div class="form-group">
                        <label>Average Shipping Cost ($):
                            <span class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Estimated cost to ship this item to the customer (carrier rates + packaging)</span>
                            </span>
                        </label>
                        <input type="number" id="shipping_cost" placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>

                <!-- Advanced Settings Section -->
                <div class="section">
                    <h2>Advanced Settings</h2>
                </div>

                <div class="section">
                    <div class="section-header-with-action">
                        <h3>Machine Cost Calculation</h3>
                        <button class="btn btn-secondary" onclick="openProfileManager()" title="Manage print profiles">
                            ‚öôÔ∏è Manage Profiles
                        </button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Printer Cost ($):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Initial purchase price of the 3D printer</span>
                                </span>
                            </label>
                            <input type="number" id="printer_cost" placeholder="1000.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Additional Upfront Cost ($):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Other upfront costs like enclosures, upgrades, or setup expenses</span>
                                </span>
                            </label>
                            <input type="number" id="upfront_cost" placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Annual Maintenance ($/year):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Yearly cost for nozzles, belts, bearings, and other wear parts</span>
                                </span>
                            </label>
                            <input type="number" id="annual_maintenance" placeholder="75.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Expected Printer Life (years):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">How many years you expect the printer to remain productive</span>
                                </span>
                            </label>
                            <input type="number" id="printer_life" placeholder="3.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Average Uptime (%):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Percentage of time the printer is actively printing (not idle or offline). 50% = 12 hours/day average</span>
                                </span>
                            </label>
                            <input type="number" id="average_uptime" placeholder="50.00" step="0.01" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>Calculated Print Rate ($/hour):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Automatic calculation of hourly machine depreciation cost based on settings above</span>
                                </span>
                            </label>
                            <input type="text" id="cost_per_hour" value="$0.0932 /hour" readonly class="readonly">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Electricity Cost Calculation</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Average Printer Power Consumption (W):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Average watts consumed during printing. Typical range: 200-400W. Check printer specs or measure with power meter</span>
                                </span>
                            </label>
                            <input type="number" id="power_consumption" placeholder="250" step="1" min="0" max="5000">
                        </div>
                        <div class="form-group">
                            <label>Electricity Rate Cost ($/kWh):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Your electricity cost per kilowatt-hour (check your utility bill)</span>
                                </span>
                            </label>
                            <input type="number" id="electricity_rate" placeholder="0.30" step="0.0001" min="0">
                        </div>
                        <div class="form-group">
                            <label>Electricity Daily Fixed Rate ($/day):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Daily supply charge or fixed daily fee from your electricity provider</span>
                                </span>
                            </label>
                            <input type="number" id="electricity_daily" placeholder="1.50" step="0.01" min="0">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h3>Other Factors</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Material Efficiency Factor:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Accounts for material waste, failed prints, supports. 1.1 = 10% overhead, 1.2 = 20% overhead</span>
                                </span>
                            </label>
                            <input type="number" id="efficiency_factor" placeholder="1.10" step="0.01" min="1">
                        </div>
                        <div class="form-group">
                            <label>Labor Hourly Rate ($/hour):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Your hourly rate for manual work (setup, post-processing, quality checks)</span>
                                </span>
                            </label>
                            <input type="number" id="labor_rate" placeholder="20.00" step="0.01" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Tab -->
            <div id="inventory-tab" class="tab-pane">
                <div class="section">
                    <div class="batch-header">
                        <h2>Inventory Tracking</h2>
                        <div class="batch-actions">
                            <select id="inventory_filter" onchange="updateInventoryTable()">
                                <option value="all">All Materials</option>
                                <option value="PLA">PLA Only</option>
                                <option value="PETG">PETG Only</option>
                                <option value="ABS">ABS Only</option>
                                <option value="TPU">TPU Only</option>
                                <option value="Nylon">Nylon Only</option>
                                <option value="low">Low Stock Only</option>
                            </select>
                            <input type="text" id="inventory_search" placeholder="Search materials..." oninput="updateInventoryTable()">
                            <button class="btn btn-primary" onclick="openInventoryModal()">Add Material</button>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="history-stats">
                        <div class="stat-card">
                            <div class="stat-label">Total Materials</div>
                            <div class="stat-value" id="stat_total_materials">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Low Stock Alerts</div>
                            <div class="stat-value" id="stat_low_stock">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Inventory Value</div>
                            <div class="stat-value" id="stat_inventory_value">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Most Used</div>
                            <div class="stat-value" id="stat_most_used">-</div>
                        </div>
                    </div>

                    <!-- Inventory Table -->
                    <table class="data-table" id="inventory-table">
                        <thead>
                            <tr>
                                <th>Material Name</th>
                                <th>Type</th>
                                <th>Supplier</th>
                                <th>Current Stock</th>
                                <th>Min / Max</th>
                                <th>Location</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="inventory-tbody">
                            <tr>
                                <td colspan="7" class="empty-state">No materials found. Click "Add Material" to get started.</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="batch-actions">
                        <button class="btn btn-secondary" onclick="exportInventoryToCSV()">Export to CSV</button>
                        <button class="btn btn-danger" onclick="clearAllInventory()">Clear All</button>
                    </div>
                </div>
            </div>

            <!-- Batch Quote Tab -->
            <div id="batch-tab" class="tab-pane">
                <div class="section">
                    <div class="batch-header">
                        <h2>Batch Quote Mode</h2>
                        <div class="batch-actions">
                            <button class="btn btn-secondary" onclick="addBatchRow()" title="Add new part to batch">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Add Part
                            </button>
                            <button class="btn btn-secondary" onclick="clearBatchQuotes()" title="Clear all batch quotes">
                                Clear All
                            </button>
                            <button class="btn btn-primary" onclick="calculateBatchQuotes()" title="Calculate all batch quotes">
                                Calculate All
                            </button>
                        </div>
                    </div>

                    <div class="batch-table-container">
                        <table class="batch-table" id="batch-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%;">#</th>
                                    <th style="width: 20%;">Part Name</th>
                                    <th style="width: 15%;">Material</th>
                                    <th style="width: 12%;">Weight (g)</th>
                                    <th style="width: 12%;">Print Time (h)</th>
                                    <th style="width: 10%;">Quantity</th>
                                    <th style="width: 15%;">Total Cost</th>
                                    <th style="width: 11%;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="batch-tbody">
                                <!-- Batch rows will be added dynamically -->
                            </tbody>
                            <tfoot>
                                <tr class="batch-summary-row">
                                    <td colspan="5" style="text-align: right; font-weight: 600;">Batch Total:</td>
                                    <td id="batch-total-qty" style="font-weight: 600;">0</td>
                                    <td id="batch-total-cost" style="font-weight: 700; color: var(--primary-color);">NZD $0.00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div class="batch-info">
                        <p>
                            <strong>üí° Tip:</strong> Use Batch Quote Mode to price multiple parts at once.
                            Each row uses the current settings from other tabs (labor rate, machine costs, markup, etc.).
                        </p>
                    </div>

                    <div class="batch-export-actions">
                        <button class="btn btn-secondary" onclick="exportBatchToExcel()" title="Export batch to Excel">
                            üìä Export Batch to Excel
                        </button>
                        <button class="btn btn-secondary" onclick="exportBatchToPDF()" title="Export batch to PDF">
                            üìÑ Export Batch to PDF
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div id="compare-tab" class="tab-pane">
                <div class="section">
                    <div class="compare-header">
                        <h2>Quote Comparison</h2>
                        <div class="compare-actions">
                            <button class="btn btn-secondary" onclick="addCompareSlot()">
                                + Add Option
                            </button>
                            <button class="btn btn-secondary" onclick="clearComparison()">
                                Clear All
                            </button>
                        </div>
                    </div>

                    <p class="info-text">
                        Compare different materials, quantities, or configurations side-by-side.
                        Each column uses current settings from other tabs.
                    </p>

                    <div class="comparison-grid" id="comparison-grid">
                        <p class="empty-state">Click "Add Option" to start comparing quotes</p>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-pane">
                <div class="section">
                    <div class="history-header">
                        <h2>Cost History & Trends</h2>
                        <div class="history-actions">
                            <button class="btn btn-secondary" onclick="clearHistory()" title="Clear all history data">
                                üóëÔ∏è Clear History
                            </button>
                            <button class="btn btn-secondary" onclick="exportHistoryToExcel()" title="Export history to Excel">
                                üìä Export History
                            </button>
                        </div>
                    </div>

                    <!-- Filter Controls -->
                    <div class="history-filters">
                        <div class="form-group">
                            <label>Date Range:</label>
                            <select id="history_date_filter" onchange="updateHistoryChart()">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Material Filter:</label>
                            <select id="history_material_filter" onchange="updateHistoryChart()">
                                <option value="all" selected>All Materials</option>
                                <option value="PLA">PLA</option>
                                <option value="PETG">PETG</option>
                                <option value="ABS">ABS</option>
                                <option value="TPU">TPU</option>
                                <option value="Nylon">Nylon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Show:</label>
                            <select id="history_favorite_filter" onchange="updateHistoryDisplay()">
                                <option value="all">All Quotes</option>
                                <option value="favorites">Favorites Only</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Chart Type:</label>
                            <select id="history_chart_type" onchange="updateHistoryChart()">
                                <option value="line" selected>Line Chart</option>
                                <option value="bar">Bar Chart</option>
                                <option value="scatter">Scatter Plot</option>
                            </select>
                        </div>
                    </div>

                    <!-- Chart Canvas -->
                    <div class="chart-container">
                        <canvas id="history_chart"></canvas>
                    </div>

                    <!-- Stats Summary -->
                    <div class="history-stats">
                        <div class="stat-card">
                            <div class="stat-label">Total Quotes</div>
                            <div class="stat-value" id="stat_total_quotes">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Average Cost</div>
                            <div class="stat-value" id="stat_avg_cost">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Highest Cost</div>
                            <div class="stat-value" id="stat_max_cost">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Lowest Cost</div>
                            <div class="stat-value" id="stat_min_cost">NZD $0.00</div>
                        </div>
                    </div>

                    <!-- Recent Quotes Table -->
                    <div class="history-table-container">
                        <h3>Recent Quotes</h3>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th style="width: 50px;">Fav</th>
                                    <th>Date</th>
                                    <th>Part Name</th>
                                    <th>Material</th>
                                    <th>Weight (g)</th>
                                    <th>Print Time (h)</th>
                                    <th>Total Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="history-tbody">
                                <tr>
                                    <td colspan="8" class="empty-state">No quotes saved yet. Calculate a quote to start tracking history.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Clients Tab -->
            <div id="clients-tab" class="tab-pane">
                <div class="section">
                    <div class="batch-header">
                        <h2>Client Management</h2>
                        <div class="batch-actions">
                            <select id="client_filter" onchange="updateClientTable()">
                                <option value="all">All Clients</option>
                                <option value="starred">Favorites Only</option>
                                <option value="active">Active (30 days)</option>
                            </select>
                            <input type="text" id="client_search" placeholder="Search clients..." oninput="updateClientTable()">
                            <button class="btn btn-primary" onclick="openClientModal()">Add Client</button>
                        </div>
                    </div>

                    <!-- Stats Cards -->
                    <div class="history-stats">
                        <div class="stat-card">
                            <div class="stat-label">Total Clients</div>
                            <div class="stat-value" id="stat_total_clients">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Active Clients (30d)</div>
                            <div class="stat-value" id="stat_active_clients">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total Revenue</div>
                            <div class="stat-value" id="stat_total_revenue">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Average Quote Value</div>
                            <div class="stat-value" id="stat_avg_quote">NZD $0.00</div>
                        </div>
                    </div>

                    <!-- Client Table -->
                    <table class="data-table" id="clients-table">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Client Name</th>
                                <th>Contact</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Discount</th>
                                <th>Total Quotes</th>
                                <th>Total Spent</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="clients-tbody">
                            <tr>
                                <td colspan="9" class="empty-state">No clients found. Click "Add Client" to get started.</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="batch-actions">
                        <button class="btn btn-secondary" onclick="exportClientsToCSV()">Export to CSV</button>
                        <button class="btn btn-danger" onclick="clearAllClients()">Clear All Clients</button>
                    </div>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="settings-tab" class="tab-pane">
                <div class="tab-header">
                    <h2>Settings</h2>
                    <p>Configure application preferences and behavior</p>
                </div>

                <div class="settings-grid">
                    <!-- Location & Currency -->
                    <div class="settings-section">
                        <h3>Location & Currency</h3>
                        <div class="form-group">
                            <label>Location:</label>
                            <input type="text" id="setting_location" value="Christchurch, NZ">
                        </div>
                        <div class="form-group">
                            <label>Currency:</label>
                            <select id="setting_currency">
                                <option value="NZD" selected>NZD (New Zealand Dollar)</option>
                                <option value="AUD">AUD (Australian Dollar)</option>
                                <option value="USD">USD (US Dollar)</option>
                                <option value="EUR">EUR (Euro)</option>
                                <option value="GBP">GBP (British Pound)</option>
                                <option value="CAD">CAD (Canadian Dollar)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Display Preferences -->
                    <div class="settings-section">
                        <h3>Display Preferences</h3>
                        <div class="form-group">
                            <label>Units:</label>
                            <select id="setting_units">
                                <option value="metric" selected>Metric (g, mm)</option>
                                <option value="imperial">Imperial (oz, in)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Decimal Places:</label>
                            <select id="setting_decimal_places">
                                <option value="2" selected>2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="setting_auto_calculate" checked>
                                Auto-calculate on input change
                            </label>
                        </div>
                    </div>

                    <!-- Company Information -->
                    <div class="settings-section">
                        <h3>Company Information</h3>
                        <div class="form-group">
                            <label>Company Name:</label>
                            <input type="text" id="setting_company_name" placeholder="Your Company Name">
                        </div>
                    </div>

                    <!-- Price Alerts -->
                    <div class="settings-section">
                        <h3>Price Alerts</h3>
                        <div class="form-group">
                            <label>Target Price Threshold ($):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Get visual warnings when quote total exceeds this amount. Leave blank to disable.</span>
                                </span>
                            </label>
                            <input type="number" id="setting_price_threshold" placeholder="e.g. 100" min="0" step="1">
                        </div>
                    </div>

                    <!-- Automatic Backups -->
                    <div class="settings-section">
                        <h3>Automatic Backups</h3>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="backup_enabled">
                                Enable automatic backups
                            </label>
                        </div>
                        <div id="backup-settings-details" style="display: none;">
                            <div class="form-group">
                                <label>Backup Frequency:</label>
                                <select id="backup_frequency">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_auto_download">
                                    Auto-download backups to Downloads folder
                                </label>
                            </div>
                            <div class="form-group">
                                <label>Include in Backups:</label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_settings" checked>
                                    App Settings
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_clients" checked>
                                    Clients
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_templates" checked>
                                    Quote Templates
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_history" checked>
                                    Quote History
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_profiles" checked>
                                    Print Profiles
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="backup_include_presets" checked>
                                    Material Presets
                                </label>
                            </div>
                            <div class="form-group">
                                <p class="backup-status">
                                    Last backup: <span id="backup_last_time">Never</span>
                                </p>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="openBackupManager()">Manage Backups</button>
                            <button class="btn btn-primary" onclick="createManualBackup()">Backup Now</button>
                        </div>
                    </div>

                    <!-- Reset -->
                    <div class="settings-section">
                        <h3>Reset</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 12px;">
                            Reset all settings to default values. This will not affect your saved data.
                        </p>
                        <button class="btn btn-danger" onclick="resetSettings()" style="width: 100%;">
                            Reset All Settings
                        </button>
                    </div>
                </div>

                <div class="settings-actions">
                    <button class="btn btn-primary" onclick="applySettings()">Save Settings</button>
                </div>
            </div>

            <div id="results-tab" class="tab-pane">
                <!-- Price Alert Banner -->
                <div id="price-alert-banner" class="price-alert-banner" style="display: none;">
                    <div class="alert-content">
                        <span class="alert-icon">!</span>
                        <div class="alert-text">
                            <strong>Price Alert</strong>
                            <p id="alert-message"></p>
                        </div>
                        <button class="alert-close" onclick="dismissPriceAlert()">&times;</button>
                    </div>
                </div>

                <!-- Quick Summary Card -->
                <div class="summary-card">
                    <div class="summary-header">
                        <h3>At-a-Glance Summary</h3>
                        <button class="collapse-btn" onclick="toggleSummary()" title="Collapse/Expand">‚àí</button>
                    </div>
                    <div class="summary-content" id="summary-content">
                        <div class="summary-main">
                            <div class="summary-item-large">
                                <span class="summary-label">Total Cost</span>
                                <span class="summary-value-large" id="summary_total_cost">NZD $0.00</span>
                            </div>
                            <div class="summary-item-large">
                                <span class="summary-label">Recommended Price (70%)</span>
                                <span class="summary-value-large highlight" id="summary_recommended_price">NZD $0.00</span>
                            </div>
                        </div>
                        <div class="summary-breakdown">
                            <div class="summary-item-small">
                                <span class="summary-label">Materials</span>
                                <span class="summary-value" id="summary_materials">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Labor</span>
                                <span class="summary-value" id="summary_labor">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Machine</span>
                                <span class="summary-value" id="summary_machine">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Packaging</span>
                                <span class="summary-value" id="summary_packaging">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small" id="summary_discount_item" style="display: none;">
                                <span class="summary-label">Client Discount</span>
                                <span class="summary-value" id="summary_discount" style="color: var(--success-color);">-NZD $0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Cost Breakdown</h2>
                    <div class="results-grid">
                        <div class="result-item">
                            <label>Materials Cost:</label>
                            <span id="result_material_cost" class="result-value">$0.00</span>
                        </div>
                        <div class="result-item">
                            <label>Labor Cost:</label>
                            <span id="result_labor_cost" class="result-value">$0.00</span>
                        </div>
                        <div class="result-item">
                            <label>Machine Cost:</label>
                            <span id="result_machine_cost" class="result-value">$0.00 (Depreciation: $0.00 + Electricity: $0.00)</span>
                        </div>
                        <div class="result-item">
                            <label>Packaging & Shipping:</label>
                            <span id="result_packaging_cost" class="result-value">$0.00</span>
                        </div>
                        <div class="result-item" id="result_discount_item" style="display: none;">
                            <label>Client Discount:</label>
                            <span id="result_discount" class="result-value" style="color: var(--success-color);">-$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="section total-cost-section">
                    <h2>Total Landed Cost</h2>
                    <div id="result_total_cost" class="total-cost">$0.00</div>
                </div>

                <div class="section">
                    <h2>Suggested Pricing by Margin</h2>
                    <div class="pricing-grid">
                        <div class="pricing-item">
                            <label>50% Margin Price:</label>
                            <span id="result_price_50" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item">
                            <label>60% Margin Price:</label>
                            <span id="result_price_60" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item">
                            <label>70% Margin Price:</label>
                            <span id="result_price_70" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item custom-margin">
                            <label>Custom Margin Price:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Set your own custom profit margin percentage to see the resulting price</span>
                                </span>
                            </label>
                            <div class="custom-margin-controls">
                                <input type="number" id="custom_margin" placeholder="75" min="0" max="99" step="1">
                                <span class="percent-symbol">%</span>
                                <span id="result_price_custom" class="price-value">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Quote Notes</h2>
                    <div class="form-group">
                        <label>Additional Notes:
                            <span class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Add custom notes or terms for this quote. Notes will be included in PDF exports.</span>
                            </span>
                        </label>
                        <textarea id="quote_notes" rows="4"
                                  placeholder="Add any special requirements, terms, or notes for this quote..."
                                  class="notes-textarea"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button for Calculate -->
    <button class="fab-calculate" onclick="calculateAndShowResults()" title="Calculate & View Results">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="23 4 23 10 17 10"/>
            <polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
    </button>

    <!-- Low Stock Alert Banner -->
    <div id="inventory-alert-banner" class="alert-banner" style="display: none;">
        <div class="alert-content">
            <strong>!</strong>
            <span id="inventory-alert-text">Low stock detected</span>
            <button class="btn btn-sm" onclick="goToInventoryTab()">View Inventory</button>
        </div>
        <button class="alert-close" onclick="dismissInventoryAlert()">‚úï</button>
    </div>

    <!-- Client Modal -->
    <div id="client-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="client-modal-title">Add Client</h2>
                <button class="close-btn" onclick="closeClientModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Client Name: <span class="required">*</span></label>
                        <input type="text" id="client_name" placeholder="Company or individual name">
                    </div>
                    <div class="form-group">
                        <label>Contact Person:</label>
                        <input type="text" id="client_contact" placeholder="Primary contact">
                    </div>
                    <div class="form-group">
                        <label>Email: <span class="required">*</span></label>
                        <input type="email" id="client_email" placeholder="contact@example.com">
                    </div>
                    <div class="form-group">
                        <label>Phone:</label>
                        <input type="tel" id="client_phone" placeholder="+64 21 123 4567">
                    </div>
                    <div class="form-group">
                        <label>Address:</label>
                        <input type="text" id="client_address" placeholder="Street address, city">
                    </div>
                    <div class="form-group">
                        <label>Default Discount (%):</label>
                        <input type="number" id="client_discount" min="0" max="100" value="0" step="1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes:</label>
                    <textarea id="client_notes" rows="3" placeholder="Special requirements, preferences, etc."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeClientModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveClient()">Save Client</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div id="inventory-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="inventory-modal-title">Add Material</h2>
                <button class="close-btn" onclick="closeInventoryModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Material Name: <span class="required">*</span></label>
                        <input type="text" id="inv_material_name" placeholder="e.g., PLA - Black">
                    </div>
                    <div class="form-group">
                        <label>Material Type: <span class="required">*</span></label>
                        <select id="inv_material_type">
                            <option value="PLA">PLA</option>
                            <option value="PETG">PETG</option>
                            <option value="ABS">ABS</option>
                            <option value="TPU">TPU</option>
                            <option value="Nylon">Nylon</option>
                            <option value="Carbon Fiber">Carbon Fiber</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Supplier:</label>
                        <input type="text" id="inv_supplier" placeholder="e.g., Formtech NZ">
                    </div>
                    <div class="form-group">
                        <label>Cost per kg: <span class="required">*</span></label>
                        <input type="number" id="inv_cost_per_kg" min="0" step="0.01" placeholder="40.00">
                    </div>
                    <div class="form-group">
                        <label>Current Stock (g): <span class="required">*</span></label>
                        <input type="number" id="inv_current_stock" min="0" step="1" placeholder="2500">
                    </div>
                    <div class="form-group">
                        <label>Minimum Stock (g): <span class="required">*</span></label>
                        <input type="number" id="inv_min_stock" min="0" step="1" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label>Maximum Stock (g):</label>
                        <input type="number" id="inv_max_stock" min="0" step="1" placeholder="5000">
                    </div>
                    <div class="form-group">
                        <label>Storage Location:</label>
                        <input type="text" id="inv_location" placeholder="e.g., Shelf A-1">
                    </div>
                </div>
                <div class="form-group">
                    <label>Notes:</label>
                    <textarea id="inv_notes" rows="2" placeholder="Special notes about this material..."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeInventoryModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveInventoryItem()">Save Material</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Restock Modal -->
    <div id="restock-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Restock Material</h2>
                <button class="close-btn" onclick="closeRestockModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <p><strong id="restock_material_name">Material Name</strong></p>
                <p class="text-secondary">Current Stock: <span id="restock_current_stock">0</span>g</p>
                <div class="form-group">
                    <label>Add Amount (g): <span class="required">*</span></label>
                    <input type="number" id="restock_amount" min="0" step="1" placeholder="1000">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeRestockModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmRestock()">Restock</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Template Manager Modal -->
    <div id="template-manager-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2>Quote Template Manager</h2>
                <button class="close-btn" onclick="closeTemplateManager()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="template-tabs">
                    <button class="template-tab active" data-category="all" onclick="filterTemplatesByCategory('all')">
                        All Templates
                    </button>
                    <button class="template-tab" data-category="Standard" onclick="filterTemplatesByCategory('Standard')">
                        Standard
                    </button>
                    <button class="template-tab" data-category="Premium" onclick="filterTemplatesByCategory('Premium')">
                        Premium
                    </button>
                    <button class="template-tab" data-category="Economy" onclick="filterTemplatesByCategory('Economy')">
                        Economy
                    </button>
                </div>
                <div class="form-group">
                    <input type="text" id="template_search" placeholder="Search templates..." oninput="filterTemplates()">
                </div>
                <div class="template-grid" id="template-grid">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Save as Template Modal -->
    <div id="save-template-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="save-template-title">Save as Template</h2>
                <button class="close-btn" onclick="closeSaveTemplateModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Template Name: <span class="required">*</span></label>
                    <input type="text" id="template_name" placeholder="e.g., Standard PLA Print">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="template_description" rows="3" placeholder="Brief description of this template..."></textarea>
                </div>
                <div class="form-group">
                    <label>Category: <span class="required">*</span></label>
                    <select id="template_category">
                        <option value="Standard">Standard</option>
                        <option value="Premium">Premium</option>
                        <option value="Economy">Economy</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="template_link_client">
                        Link to client (saves client-specific template)
                    </label>
                </div>
                <div class="form-group" id="template_client_selector_group" style="display: none;">
                    <label>Select Client:</label>
                    <select id="template_client">
                        <!-- Populated from clients -->
                    </select>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeSaveTemplateModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveQuoteTemplate()">Save Template</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Material Preset Modal -->
    <div id="material-preset-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="material-preset-title">Add Material Preset</h2>
                <button class="close-btn" onclick="closeMaterialPresetModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Preset Name: <span class="required">*</span></label>
                    <input type="text" id="preset_name" placeholder="e.g., My PLA Setup">
                </div>
                <div class="form-group">
                    <label>Material Type: <span class="required">*</span></label>
                    <input type="text" id="preset_material" placeholder="e.g., PLA, PETG, ABS">
                </div>
                <div class="form-group">
                    <label>Cost (NZD/kg): <span class="required">*</span></label>
                    <input type="number" id="preset_cost" placeholder="45.00" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>Supplier:</label>
                    <input type="text" id="preset_supplier" placeholder="e.g., Formtech NZ (optional)">
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="closeMaterialPresetModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="saveMaterialPreset()">Save Preset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preset Manager Modal -->
    <div id="preset-manager-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>Manage Material Presets</h2>
                <button class="close-btn" onclick="closePresetManager()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="batch-info">
                    <p><strong>Tip:</strong> Create custom material presets to quickly apply your common material costs.</p>
                </div>
                <table class="data-table" id="preset-manager-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Material</th>
                            <th>Cost/kg</th>
                            <th>Supplier</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="preset-manager-tbody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                <div style="margin-top: 16px;">
                    <button class="btn btn-primary" onclick="openMaterialPresetModal()">
                        ‚ûï Add New Preset
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Backup Manager Modal -->
    <div id="backup-manager-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Backup Manager</h2>
                <button class="close-btn" onclick="closeBackupManager()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="batch-info">
                    <p><strong>Tip:</strong> Backups are stored in your browser's localStorage. Export them to JSON files for safekeeping.</p>
                </div>
                <table class="data-table" id="backup-history-table">
                    <thead>
                        <tr>
                            <th>Date & Time</th>
                            <th>Type</th>
                            <th>Items</th>
                            <th>Size</th>
                            <th>Data Included</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="backup-history-tbody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
                <div class="batch-actions">
                    <button class="btn btn-secondary" onclick="createManualBackup()">Create New Backup</button>
                    <button class="btn btn-danger" onclick="clearBackupHistory()">Clear History</button>
                </div>
                <div class="form-group">
                    <label>Restore from File:</label>
                    <input type="file" id="backup_restore_input" accept=".json" onchange="restoreFromFile(event)">
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
