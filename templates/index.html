<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrintForge Pricing Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.1/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="PrintForge Logo" class="logo-icon">
                <span class="brand">PrintForge</span> Pricing Calculator
            </h1>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" title="Toggle theme">
                    <span id="themeIcon"></span>
                    <span id="themeText">Dark</span>
                </button>
                <button class="settings-toggle" onclick="toggleSettings()" title="Open Settings">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6m6-12l-4 4m-4 4-4 4m16-4h-6m-6 0H1m18-8l-4 4m-4 4-4 4"/>
                    </svg>
                    <span>Settings</span>
                </button>
            </div>
        </header>

        <!-- Tab Navigation -->
        <div class="tabs">
            <button class="tab-button active" data-tab="basic">Basic Info</button>
            <button class="tab-button" data-tab="hardware">Hardware</button>
            <button class="tab-button" data-tab="packaging">Packaging</button>
            <button class="tab-button" data-tab="advanced">Advanced</button>
            <button class="tab-button" data-tab="batch">Batch Quote</button>
            <button class="tab-button" data-tab="compare">Compare</button>
            <button class="tab-button" data-tab="history">History</button>
            <button class="tab-button" data-tab="results">Results</button>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn btn-secondary" onclick="saveConfig()" title="Save configuration (Ctrl+S)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                Save
            </button>
            <button class="btn btn-secondary" onclick="document.getElementById('load-file').click()" title="Load configuration (Ctrl+L)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 15v4c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                </svg>
                Load
            </button>
            <input type="file" id="load-file" accept=".json" style="display: none;" onchange="loadConfig(event)">
            <div class="export-dropdown">
                <button class="btn btn-secondary" onclick="toggleExportMenu()" title="Export options">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    Export
                    <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" style="margin-left: 4px;">
                        <polyline points="6 9 12 15 18 9"/>
                    </svg>
                </button>
                <div class="export-menu" id="export-menu" style="display: none;">
                    <button onclick="exportToExcel(); toggleExportMenu();">üìä Export to Excel</button>
                    <button onclick="exportToPDF(); toggleExportMenu();">üìÑ Export to PDF</button>
                </div>
            </div>
            <div class="spacer"></div>
            <button class="btn btn-primary" onclick="calculate()" title="Recalculate pricing (Ctrl+R)">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
                Recalculate
            </button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            
            <!-- Basic Info Tab -->
            <div id="basic-tab" class="tab-pane active">
                <div class="section">
                    <h2>Product Information</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Part Name:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">The name of the part or product being quoted</span>
                                </span>
                            </label>
                            <input type="text" id="part_name" placeholder="New Part">
                        </div>
                        <div class="form-group">
                            <label>Revision:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Version number of this part design (e.g., V1, V2, Rev A)</span>
                                </span>
                            </label>
                            <input type="text" id="revision" placeholder="V1">
                        </div>
                        <div class="form-group">
                            <label>Prepared By:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Name of the person creating this quote</span>
                                </span>
                            </label>
                            <input type="text" id="prepared_by" placeholder="Your Name">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Material & Print Settings</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Material Type:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Type of filament material used for printing (affects cost and properties)</span>
                                </span>
                            </label>
                            <select id="material_type">
                                <option value="PLA">PLA (Polylactic Acid)</option>
                                <option value="PLA+">PLA+ (Enhanced PLA)</option>
                                <option value="ABS">ABS (Acrylonitrile Butadiene Styrene)</option>
                                <option value="PETG">PETG (Polyethylene Terephthalate Glycol)</option>
                                <option value="ASA">ASA (Acrylonitrile Styrene Acrylate)</option>
                                <option value="TPU">TPU (Thermoplastic Polyurethane)</option>
                                <option value="TPE">TPE (Thermoplastic Elastomer)</option>
                                <option value="Nylon">Nylon (Polyamide)</option>
                                <option value="Nylon 6">Nylon 6</option>
                                <option value="Nylon 12">Nylon 12</option>
                                <option value="PC">PC (Polycarbonate)</option>
                                <option value="PC-ABS">PC-ABS Blend</option>
                                <option value="HIPS">HIPS (High Impact Polystyrene)</option>
                                <option value="PVA">PVA (Polyvinyl Alcohol - Support)</option>
                                <option value="BVOH">BVOH (Support Material)</option>
                                <option value="Carbon Fiber PLA">Carbon Fiber PLA</option>
                                <option value="Carbon Fiber PETG">Carbon Fiber PETG</option>
                                <option value="Carbon Fiber Nylon">Carbon Fiber Nylon</option>
                                <option value="Glass Fiber Nylon">Glass Fiber Nylon</option>
                                <option value="Wood PLA">Wood PLA</option>
                                <option value="Metal PLA">Metal PLA</option>
                                <option value="Marble PLA">Marble PLA</option>
                                <option value="Silk PLA">Silk PLA</option>
                                <option value="Glow in the Dark PLA">Glow in the Dark PLA</option>
                                <option value="PEEK">PEEK (Polyether Ether Ketone)</option>
                                <option value="PEKK">PEKK (Polyetherketoneketone)</option>
                                <option value="PEI">PEI (Polyetherimide/ULTEM)</option>
                                <option value="PPSU">PPSU (Polyphenylsulfone)</option>
                                <option value="PP">PP (Polypropylene)</option>
                                <option value="PMMA">PMMA (Acrylic)</option>
                                <option value="PET">PET (Polyethylene Terephthalate)</option>
                                <option value="Flexible PLA">Flexible PLA</option>
                                <option value="TPU 95A">TPU 95A (Shore Hardness)</option>
                                <option value="TPU 85A">TPU 85A (Shore Hardness)</option>
                                <option value="PVB">PVB (Polyvinyl Butyral)</option>
                                <option value="PVDF">PVDF (Polyvinylidene Fluoride)</option>
                            </select>
                        </div>
                        <!-- Simplified Material Cost Presets -->
                        <div class="material-presets-section">
                            <div class="preset-header">
                                <h4>Material Cost Presets</h4>
                                <button class="btn btn-sm btn-secondary" onclick="togglePresetForm()" id="preset-toggle-btn">
                                    ‚ûï Create Custom Preset
                                </button>
                            </div>

                            <!-- Create Preset Form (Hidden by default) -->
                            <div class="preset-form" id="preset-form" style="display: none;">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Preset Name:</label>
                                        <input type="text" id="new_preset_name" placeholder="e.g., My PLA Setup">
                                    </div>
                                    <div class="form-group">
                                        <label>Material Type:</label>
                                        <input type="text" id="new_preset_material" placeholder="e.g., PLA, PETG, ABS">
                                    </div>
                                    <div class="form-group">
                                        <label>Cost (NZD/kg):</label>
                                        <input type="number" id="new_preset_cost" placeholder="45.00" step="0.01" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label>Supplier (optional):</label>
                                        <input type="text" id="new_preset_supplier" placeholder="e.g., Formtech NZ">
                                    </div>
                                </div>
                                <div class="preset-form-actions">
                                    <button class="btn btn-primary" onclick="saveCustomPreset()">
                                        üíæ Save Preset
                                    </button>
                                    <button class="btn btn-secondary" onclick="togglePresetForm()">
                                        Cancel
                                    </button>
                                </div>
                            </div>

                            <!-- Select Preset Dropdown -->
                            <div class="form-group" style="margin-top: 16px;">
                                <label>Select Saved Preset:</label>
                                <select id="custom_preset_select" onchange="applyCustomPreset()">
                                    <option value="">-- Select a Preset --</option>
                                </select>
                            </div>

                            <div class="preset-actions" id="preset-actions" style="display: none; margin-top: 8px;">
                                <button class="btn btn-sm btn-danger" onclick="deleteSelectedPreset()">
                                    üóëÔ∏è Delete Selected
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Filament Cost (NZD/kg):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Cost per kilogram of filament material (check your supplier pricing)</span>
                                </span>
                            </label>
                            <input type="number" id="filament_cost" placeholder="40.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Filament Required (g):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Total grams of filament needed for this print (from slicer software)</span>
                                </span>
                            </label>
                            <input type="number" id="filament_required" placeholder="34.78" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Total Print Time (hours):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Estimated print duration in hours (from slicer software)</span>
                                </span>
                            </label>
                            <input type="number" id="print_time" placeholder="4.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Labor Required (minutes):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Time needed for setup, removal, cleanup, and post-processing (minutes)</span>
                                </span>
                            </label>
                            <input type="number" id="labor_time" placeholder="30" step="1" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hardware Tab -->
            <div id="hardware-tab" class="tab-pane">
                <div class="section">
                    <p class="info-text">Add hardware components like screws, magnets, inserts, etc.</p>
                    
                    <table id="hardware-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Unit Cost ($)</th>
                                <th>Total ($)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Hardware rows will be added here -->
                        </tbody>
                    </table>

                    <button class="btn btn-secondary" onclick="addHardwareRow()">Add Item</button>
                </div>
            </div>

            <!-- Packaging Tab -->
            <div id="packaging-tab" class="tab-pane">
                <div class="section">
                    <p class="info-text">Add packaging materials like boxes, bubble wrap, tape, and shipping costs.</p>
                    
                    <table id="packaging-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Quantity</th>
                                <th>Unit Cost ($)</th>
                                <th>Total ($)</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Packaging rows will be added here -->
                        </tbody>
                    </table>

                    <button class="btn btn-secondary" onclick="addPackagingRow()">Add Item</button>
                </div>

                <div class="section">
                    <h2>Shipping Cost</h2>
                    <div class="form-group">
                        <label>Average Shipping Cost ($):
                            <span class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Estimated cost to ship this item to the customer (carrier rates + packaging)</span>
                            </span>
                        </label>
                        <input type="number" id="shipping_cost" placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div id="advanced-tab" class="tab-pane">
                <div class="section">
                    <div class="section-header-with-action">
                        <h2>Machine Cost Calculation</h2>
                        <button class="btn btn-secondary" onclick="openProfileManager()" title="Manage print profiles">
                            ‚öôÔ∏è Manage Profiles
                        </button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Printer Cost ($):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Initial purchase price of the 3D printer</span>
                                </span>
                            </label>
                            <input type="number" id="printer_cost" placeholder="1000.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Additional Upfront Cost ($):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Other upfront costs like enclosures, upgrades, or setup expenses</span>
                                </span>
                            </label>
                            <input type="number" id="upfront_cost" placeholder="0.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Annual Maintenance ($/year):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Yearly cost for nozzles, belts, bearings, and other wear parts</span>
                                </span>
                            </label>
                            <input type="number" id="annual_maintenance" placeholder="75.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Expected Printer Life (years):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">How many years you expect the printer to remain productive</span>
                                </span>
                            </label>
                            <input type="number" id="printer_life" placeholder="3.00" step="0.01" min="0">
                        </div>
                        <div class="form-group">
                            <label>Average Uptime (%):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Percentage of time the printer is actively printing (not idle or offline). 50% = 12 hours/day average</span>
                                </span>
                            </label>
                            <input type="number" id="average_uptime" placeholder="50.00" step="0.01" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>Calculated Print Rate ($/hour):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Automatic calculation of hourly machine depreciation cost based on settings above</span>
                                </span>
                            </label>
                            <input type="text" id="cost_per_hour" value="$0.0932 /hour" readonly class="readonly">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Electricity Cost Calculation</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Average Printer Power Consumption (W):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Average watts consumed during printing. Typical range: 200-400W. Check printer specs or measure with power meter</span>
                                </span>
                            </label>
                            <input type="number" id="power_consumption" placeholder="250" step="1" min="0" max="5000">
                        </div>
                        <div class="form-group">
                            <label>Electricity Rate Cost ($/kWh):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Your electricity cost per kilowatt-hour (check your utility bill)</span>
                                </span>
                            </label>
                            <input type="number" id="electricity_rate" placeholder="0.30" step="0.0001" min="0">
                        </div>
                        <div class="form-group">
                            <label>Electricity Daily Fixed Rate ($/day):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Daily supply charge or fixed daily fee from your electricity provider</span>
                                </span>
                            </label>
                            <input type="number" id="electricity_daily" placeholder="1.50" step="0.01" min="0">
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Other Factors</h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Material Efficiency Factor:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Accounts for material waste, failed prints, supports. 1.1 = 10% overhead, 1.2 = 20% overhead</span>
                                </span>
                            </label>
                            <input type="number" id="efficiency_factor" placeholder="1.10" step="0.01" min="1">
                        </div>
                        <div class="form-group">
                            <label>Labor Hourly Rate ($/hour):
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Your hourly rate for manual work (setup, post-processing, quality checks)</span>
                                </span>
                            </label>
                            <input type="number" id="labor_rate" placeholder="20.00" step="0.01" min="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Batch Quote Tab -->
            <div id="batch-tab" class="tab-pane">
                <div class="section">
                    <div class="batch-header">
                        <h2>Batch Quote Mode</h2>
                        <div class="batch-actions">
                            <button class="btn btn-secondary" onclick="addBatchRow()" title="Add new part to batch">
                                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Add Part
                            </button>
                            <button class="btn btn-secondary" onclick="clearBatchQuotes()" title="Clear all batch quotes">
                                Clear All
                            </button>
                            <button class="btn btn-primary" onclick="calculateBatchQuotes()" title="Calculate all batch quotes">
                                Calculate All
                            </button>
                        </div>
                    </div>

                    <div class="batch-table-container">
                        <table class="batch-table" id="batch-table">
                            <thead>
                                <tr>
                                    <th style="width: 5%;">#</th>
                                    <th style="width: 20%;">Part Name</th>
                                    <th style="width: 15%;">Material</th>
                                    <th style="width: 12%;">Weight (g)</th>
                                    <th style="width: 12%;">Print Time (h)</th>
                                    <th style="width: 10%;">Quantity</th>
                                    <th style="width: 15%;">Total Cost</th>
                                    <th style="width: 11%;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="batch-tbody">
                                <!-- Batch rows will be added dynamically -->
                            </tbody>
                            <tfoot>
                                <tr class="batch-summary-row">
                                    <td colspan="5" style="text-align: right; font-weight: 600;">Batch Total:</td>
                                    <td id="batch-total-qty" style="font-weight: 600;">0</td>
                                    <td id="batch-total-cost" style="font-weight: 700; color: var(--primary-color);">NZD $0.00</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                    <div class="batch-info">
                        <p>
                            <strong>üí° Tip:</strong> Use Batch Quote Mode to price multiple parts at once.
                            Each row uses the current settings from other tabs (labor rate, machine costs, markup, etc.).
                        </p>
                    </div>

                    <div class="batch-export-actions">
                        <button class="btn btn-secondary" onclick="exportBatchToExcel()" title="Export batch to Excel">
                            üìä Export Batch to Excel
                        </button>
                        <button class="btn btn-secondary" onclick="exportBatchToPDF()" title="Export batch to PDF">
                            üìÑ Export Batch to PDF
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compare Tab -->
            <div id="compare-tab" class="tab-pane">
                <div class="section">
                    <div class="compare-header">
                        <h2>Quote Comparison</h2>
                        <div class="compare-actions">
                            <button class="btn btn-secondary" onclick="addCompareSlot()">
                                ‚ûï Add Option
                            </button>
                            <button class="btn btn-secondary" onclick="clearComparison()">
                                üóëÔ∏è Clear All
                            </button>
                        </div>
                    </div>

                    <p class="info-text">
                        Compare different materials, quantities, or configurations side-by-side.
                        Each column uses current settings from other tabs.
                    </p>

                    <div class="comparison-grid" id="comparison-grid">
                        <p class="empty-state">Click "Add Option" to start comparing quotes</p>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-pane">
                <div class="section">
                    <div class="history-header">
                        <h2>Cost History & Trends</h2>
                        <div class="history-actions">
                            <button class="btn btn-secondary" onclick="clearHistory()" title="Clear all history data">
                                üóëÔ∏è Clear History
                            </button>
                            <button class="btn btn-secondary" onclick="exportHistoryToExcel()" title="Export history to Excel">
                                üìä Export History
                            </button>
                        </div>
                    </div>

                    <!-- Filter Controls -->
                    <div class="history-filters">
                        <div class="form-group">
                            <label>Date Range:</label>
                            <select id="history_date_filter" onchange="updateHistoryChart()">
                                <option value="7">Last 7 Days</option>
                                <option value="30" selected>Last 30 Days</option>
                                <option value="90">Last 90 Days</option>
                                <option value="365">Last Year</option>
                                <option value="all">All Time</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Material Filter:</label>
                            <select id="history_material_filter" onchange="updateHistoryChart()">
                                <option value="all" selected>All Materials</option>
                                <option value="PLA">PLA</option>
                                <option value="PETG">PETG</option>
                                <option value="ABS">ABS</option>
                                <option value="TPU">TPU</option>
                                <option value="Nylon">Nylon</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Chart Type:</label>
                            <select id="history_chart_type" onchange="updateHistoryChart()">
                                <option value="line" selected>Line Chart</option>
                                <option value="bar">Bar Chart</option>
                                <option value="scatter">Scatter Plot</option>
                            </select>
                        </div>
                    </div>

                    <!-- Chart Canvas -->
                    <div class="chart-container">
                        <canvas id="history_chart"></canvas>
                    </div>

                    <!-- Stats Summary -->
                    <div class="history-stats">
                        <div class="stat-card">
                            <div class="stat-label">Total Quotes</div>
                            <div class="stat-value" id="stat_total_quotes">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Average Cost</div>
                            <div class="stat-value" id="stat_avg_cost">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Highest Cost</div>
                            <div class="stat-value" id="stat_max_cost">NZD $0.00</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Lowest Cost</div>
                            <div class="stat-value" id="stat_min_cost">NZD $0.00</div>
                        </div>
                    </div>

                    <!-- Recent Quotes Table -->
                    <div class="history-table-container">
                        <h3>Recent Quotes</h3>
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Part Name</th>
                                    <th>Material</th>
                                    <th>Weight (g)</th>
                                    <th>Print Time (h)</th>
                                    <th>Total Cost</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="history-tbody">
                                <tr>
                                    <td colspan="7" class="empty-state">No quotes saved yet. Calculate a quote to start tracking history.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Results Tab -->
            <div id="results-tab" class="tab-pane">
                <!-- Quick Summary Card -->
                <div class="summary-card">
                    <div class="summary-header">
                        <h3>At-a-Glance Summary</h3>
                        <button class="collapse-btn" onclick="toggleSummary()" title="Collapse/Expand">‚àí</button>
                    </div>
                    <div class="summary-content" id="summary-content">
                        <div class="summary-main">
                            <div class="summary-item-large">
                                <span class="summary-label">Total Cost</span>
                                <span class="summary-value-large" id="summary_total_cost">NZD $0.00</span>
                            </div>
                            <div class="summary-item-large">
                                <span class="summary-label">Recommended Price (70%)</span>
                                <span class="summary-value-large highlight" id="summary_recommended_price">NZD $0.00</span>
                            </div>
                        </div>
                        <div class="summary-breakdown">
                            <div class="summary-item-small">
                                <span class="summary-label">Materials</span>
                                <span class="summary-value" id="summary_materials">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Labor</span>
                                <span class="summary-value" id="summary_labor">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Machine</span>
                                <span class="summary-value" id="summary_machine">NZD $0.00</span>
                            </div>
                            <div class="summary-item-small">
                                <span class="summary-label">Packaging</span>
                                <span class="summary-value" id="summary_packaging">NZD $0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Cost Breakdown</h2>
                    <div class="results-grid">
                        <div class="result-item">
                            <label>Materials Cost:</label>
                            <span id="result_material_cost" class="result-value">$0.00</span>
                        </div>
                        <div class="result-item">
                            <label>Labor Cost:</label>
                            <span id="result_labor_cost" class="result-value">$0.00</span>
                        </div>
                        <div class="result-item">
                            <label>Machine Cost:</label>
                            <span id="result_machine_cost" class="result-value">$0.00 (Depreciation: $0.00 + Electricity: $0.00)</span>
                        </div>
                        <div class="result-item">
                            <label>Packaging & Shipping:</label>
                            <span id="result_packaging_cost" class="result-value">$0.00</span>
                        </div>
                    </div>
                </div>

                <div class="section total-cost-section">
                    <h2>Total Landed Cost</h2>
                    <div id="result_total_cost" class="total-cost">$0.00</div>
                </div>

                <div class="section">
                    <h2>Suggested Pricing by Margin</h2>
                    <div class="pricing-grid">
                        <div class="pricing-item">
                            <label>50% Margin Price:</label>
                            <span id="result_price_50" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item">
                            <label>60% Margin Price:</label>
                            <span id="result_price_60" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item">
                            <label>70% Margin Price:</label>
                            <span id="result_price_70" class="price-value">$0.00</span>
                        </div>
                        <div class="pricing-item custom-margin">
                            <label>Custom Margin Price:
                                <span class="tooltip">
                                    <span class="tooltip-icon">?</span>
                                    <span class="tooltip-text">Set your own custom profit margin percentage to see the resulting price</span>
                                </span>
                            </label>
                            <div class="custom-margin-controls">
                                <input type="number" id="custom_margin" placeholder="75" min="0" max="99" step="1">
                                <span class="percent-symbol">%</span>
                                <span id="result_price_custom" class="price-value">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>Quote Notes</h2>
                    <div class="form-group">
                        <label>Additional Notes:
                            <span class="tooltip">
                                <span class="tooltip-icon">?</span>
                                <span class="tooltip-text">Add custom notes or terms for this quote. Notes will be included in PDF exports.</span>
                            </span>
                        </label>
                        <textarea id="quote_notes" rows="4"
                                  placeholder="Add any special requirements, terms, or notes for this quote..."
                                  class="notes-textarea"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Sidebar -->
    <div class="settings-overlay" id="settings-overlay" onclick="toggleSettings()"></div>
    <div class="settings-sidebar" id="settings-sidebar">
        <div class="settings-header">
            <h2>‚öôÔ∏è Settings</h2>
            <button class="close-btn" onclick="toggleSettings()" title="Close">‚úï</button>
        </div>

        <div class="settings-content">
            <!-- Regional Settings -->
            <div class="settings-section">
                <h3>üìç Regional</h3>
                <div class="form-group">
                    <label>Location:</label>
                    <input type="text" id="setting_location" value="Christchurch, NZ">
                </div>
                <div class="form-group">
                    <label>Currency:</label>
                    <select id="setting_currency">
                        <option value="NZD" selected>NZD (New Zealand Dollar)</option>
                        <option value="AUD">AUD (Australian Dollar)</option>
                        <option value="USD">USD (US Dollar)</option>
                        <option value="EUR">EUR (Euro)</option>
                        <option value="GBP">GBP (British Pound)</option>
                        <option value="CAD">CAD (Canadian Dollar)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="setting_show_service_area" checked>
                        Show service area badge
                    </label>
                </div>
            </div>

            <!-- Display Preferences -->
            <div class="settings-section">
                <h3>üé® Display</h3>
                <div class="form-group">
                    <label>Units:</label>
                    <select id="setting_units">
                        <option value="metric" selected>Metric (g, mm)</option>
                        <option value="imperial">Imperial (oz, in)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Decimal Places:</label>
                    <select id="setting_decimal_places">
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="setting_auto_calculate" checked>
                        Auto-calculate on input change
                    </label>
                </div>
            </div>

            <!-- Export Settings -->
            <div class="settings-section">
                <h3>üì§ Export</h3>
                <div class="form-group">
                    <label>Company Name:</label>
                    <input type="text" id="setting_company_name" placeholder="Your Company Name">
                </div>
            </div>

            <!-- Advanced -->
            <div class="settings-section">
                <h3>‚ö° Advanced</h3>
                <button class="btn btn-danger" onclick="resetSettings()" style="width: 100%;">
                    Reset All Settings
                </button>
            </div>
        </div>

        <div class="settings-footer">
            <button class="btn btn-secondary" onclick="toggleSettings()">Cancel</button>
            <button class="btn btn-primary" onclick="applySettings()">Save Settings</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
